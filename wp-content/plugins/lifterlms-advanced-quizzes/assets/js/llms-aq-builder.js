(()=>{var e;e=jQuery,window.llms_builder.advanced=new function(){function t(t,n,i){if("question"===i.model.get("type")&&"blank"===i.model.get("question_type").get("id")){var s=e(t.theme.tooltip.root);s.find(".ql-formats").append('<button type="button" class="llms-aq-blank" data-length="3"><svg viewBox="0 0 18 18"><line class="ql-stroke" x1="2" x2="16" y1="15" y2="15" style="stroke-width: 3px;"></line></svg></button>').append('<button type="button" class="llms-aq-blank" data-length="24" style="width:52px"><svg viewBox="0 0 42 18"><line class="ql-stroke" x1="2" x2="40" y1="15" y2="15" style="stroke-width: 3px;"></line></svg></button>'),s.on("click","button.llms-aq-blank",(function(n){n.preventDefault();var i=t.getSelection();i&&t.insertText(i.index,"_".repeat(e(this).attr("data-length")))})),t.on("selection-change",(function(e,n,i){t.theme.tooltip.show()}))}}function n(e,t){var n=e.get_parent();n&&-1!==["reorder","picture_reorder"].indexOf(n.get("question_type").get("id"))&&e.set("correct",!0)}function i(e,t){var n,i,s=!!(i={blank:{auto_grade:"no",case_sensitive:"no"},code:{code_language:"javascript"},reorder:{multi_choices:"yes"},picture_reorder:{multi_choices:"yes"},scale:{auto_grade:"no",scale_min:1,scale_max:10},upload:{upload_restrict_filetypes:"no",upload_filetypes:[]}})[n=e.get("question_type").get("id")]&&i[n];s&&_.each(s,(function(t,n){(void 0===e.get(n)||!_.isNumber(e.get("id"))&&0===e.get("id").indexOf("temp_"))&&e.set(n,t)}))}function s(e){var t=[];return window.llms_builder.questions.forEach((function(e){"existing"!==e.id&&t.push({attribute:"qb_n_questions_type["+e.id+"]",label:e.name,input_type:"number"})})),e.default.fields=_.filter(e.default.fields,(function(e){return"question-bank"!==e[0].id})),e.default.fields.push([{attribute:"qb_n_questions",id:"question-bank",label:LLMS.l10n.translate("Question Bank"),tip:LLMS.l10n.translate("A question bank helps prevent cheating and reinforces learning by allowing instructors to create assessments with randomized questions pulled from a bank of questions."),input_description:LLMS.l10n.translate("Enter the total number of questions to be included in all quiz variations."),switch_attribute:"question_bank",type:"switch-number"}],[{attribute:"qb_n_questions_type",id:"question-bank-types",label:LLMS.l10n.translate("Number of questions per type"),tip:LLMS.l10n.translate("Select the minimum number of questions for each type to be included in all quiz variations. The total number should not be greater than the total number of questions to be included in all variations. 0 stays for unlimited."),switch_attribute:"qb_n_questions_types",type:"switch-number",inputs:t,classes:["llms-multi-input"],condition:function(){return"yes"===this.get("question_bank")}}]),e}function o(e){return e.question_bank="no",e.qb_n_questions=1,e.qb_n_questions_types="no",e.qb_n_questions_type={},window.llms_builder.questions.forEach((function(t){"existing"!==t.id&&(e.qb_n_questions_type[t.id]=0)})),e}return this.init=function(){Backbone.pubSub.on("quiz-add-question",i),Backbone.pubSub.on("question-add-choice",n),Backbone.pubSub.on("formatting-ed-init",t)},this.add_hooks=function(){window.wp.hooks.addFilter("llms_define_quiz_schema","llms/advanced_quizzes/add_question_bank",s),window.wp.hooks.addFilter("llms_quiz_model_defaults","llms/advanced_quizzes/set_question_bank_defaults",o)},this.add_hooks(),this},e(document).on("llms-builder-pre-init",window.llms_builder.advanced.init)})();